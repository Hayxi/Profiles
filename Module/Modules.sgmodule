#!name=Modules
#!desc=Local Mapping, Header Rewrite, URL Rewrite, Hostnames and Scripts.
#!system=ios

[Host]
*.taobao.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.jd.com = server:119.29.29.29
*.qq.com = server:119.29.29.29
*.tencent.com = server:119.29.29.29
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
*.weixin.com = server:119.29.29.29
*.163.com = server:119.29.29.29
*.126.com = server:119.29.29.29
*.126.net = server:119.29.29.29
*.127.net = server:119.29.29.29
*.netease.com = server:119.29.29.29
*.mi.com = server:119.29.29.29
*.xiaomi.com = server:119.29.29.29

[Header Rewrite]
^*.qpic.cn header-replace User-Agent "WeChat/6.5.22.32 CFNetwork/889.9 Darwin/17.2.0"
^https?+:\/\/www\.zhihu\.com\/question header-replace User-Agent "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15"
^https?://zhidao\.baidu\.com header-replace User-Agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.2 Safari/605.1.15

[URL Rewrite]
# > Redirect URL to TestFlight <
^https?:\/\/testflight\.apple\.com\/join\/(\w*) itms-beta://testflight.apple.com/join/$1 302

# > Redirect URL to Wikipedia <
^https?:\/\/zh\.(m.)?wikipedia\.org\/zh(-\w*)? wikipedia://zh.wikipedia.org/wiki 302

# > Redirect URL to YouTube <
^https?:\/\/m\.youtube\.com\/watch\?v\=(\w*) youtube://$1 302
^https?:\/\/m\.youtube\.com\/playlist\?list\=(\w*) youtube:///playlist?list=$1 302
^https?:\/\/m\.youtube\.com\/channel\/(\w*) youtube://www.youtube.com/channel/$1 302

[MITM]
hostname = %INSERT% testflight.apple.com, zh.wikipedia.org, zh.m.wikipedia.org, m.youtube.com, api.live.bilibili.com

[Script]
# > Remove Zhihu Ads <
http-response https://api.zhihu.com/moments/recommend requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20zhihu%20feed.js
http-response https://api.zhihu.com/topstory/recommend requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20zhihu%20recommend.js
http-response https://api.zhihu.com/v4/questions requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20zhihu%20answer.js
http-response https://api.zhihu.com/people/ requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20zhihu%20people.js

# > Remove bilibili Ads <
http-response https://app.bilibili.com/x/v2/space\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20space.js
http-response https://app.bilibili.com/x/resource/show/tab\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20tab.js
http-response https://app.bilibili.com/x/v2/feed/index\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20feed.js
http-response https://app.bilibili.com/x/v2/account/mine\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20account.js
http-response https://app.bilibili.com/x/v2/view\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20view%20relate.js
http-response https://api.bilibili.com/x/v2/reply/main\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20reply.js
http-response https://api.live.bilibili.com/xlive/app-room/v1/index/getInfoByRoom\?access_key requires-body=1,max-size=0,script-path=https://github.com/onewayticket255/Surge-Script/raw/master/surge%20bilibili%20live.js

# > Display Netflix ratings from IMDb & Douban <
http-request ^https?://ios\.prod\.ftl\.netflix\.com/iosui/user/.+path=%5B%22videos%22%2C%\d+%22%2C%22summary%22%5D script-path=https://github.com/yichahucha/surge/raw/master/nf_rating.js
http-response ^https?://ios\.prod\.ftl\.netflix\.com/iosui/user/.+path=%5B%22videos%22%2C%\d+%22%2C%22summary%22%5D requires-body=1,script-path=https://github.com/yichahucha/surge/raw/master/nf_rating.js